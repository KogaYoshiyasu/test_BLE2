<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>BLE RSSI リアルタイム受信</title>
</head>
<body>
  <h1>リアルタイム RSSI 表示</h1>
  <button id="connect">BLEデバイスに接続</button>
  <p id="rssi">RSSI: 未取得</p>

  <script>
    const serviceUuid = '12345678-1234-5678-1234-56789abcdef0';
    const characteristicUuid = 'abcdefab-1234-5678-1234-56789abcdef1';

    document.getElementById('connect').addEventListener('click', async () => {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ services: [serviceUuid] }]
        });

        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(serviceUuid);
        const characteristic = await service.getCharacteristic(characteristicUuid);

        await characteristic.startNotifications();
        
        device.addEventListener('advertisementreceived', event => {
          document.getElementById('rssi').textContent = `RSSI: ${event.rssi} dBm`;
        });

      } catch (err) {
        alert('接続エラー: ' + err);
      }
    });
  </script>
</body>
</html>
