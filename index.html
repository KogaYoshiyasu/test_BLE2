<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>BLE RSSI リアルタイム受信</title>
</head>
<body>
  <h1>リアルタイム RSSI 表示10</h1>
  <button id="scan">BLEデバイスをスキャン</button>
  <p id="rssi">未取得</p>

  <script>
    document.getElementById('scan').addEventListener('click', async () => {
      try {
        const options = {
          filters: [{ services: ['12345678-1234-5678-1234-56789abcdef0'] }],
          keepRepeatedDevices: true
        };

        const scan = await navigator.bluetooth.requestLEScan(options);

        navigator.bluetooth.addEventListener('advertisementreceived', event => {
          console.log(event);
          if (event.rssi !== undefined) {
            const array = []
            if (event.device !== undefined) {
              array.push(event.device)
            } else{array.push("device無し")}
            if (event.uuids !== undefined) {
              array.push(event.uuids)
            }else{array.push("uuids無し")}
            if (event.name !== undefined) {
              array.push(event.name)
            }else{array.push("name無し")}
            if (event.appearance !== undefined) {
              array.push(event.appearance)
            }else{array.push("appearance無し")}
            if (event.txPower !== undefined) {
              array.push(event.txPower)
            }else{array.push("txPower無し")}
            if (event.rssi !== undefined) {
              array.push(event.rssi)
            }else{array.push("rssi無し")}
            if (event.manufacturerdata !== undefined) {
              array.push(event.manufacturerdata)
            }else{array.push("manufacturerData無し")}
            if (event.serviceData !== undefined) {
              array.push(event.serviceData)
            }else{array.push("serviceData無し")}

            document.getElementById('rssi').innerText = array.join('\n')
          }
        });

      } catch (err) {
        alert('スキャンエラー: ' + err);
      }
    });
  </script>
</body>
</html>
