<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>BLEè·é›¢æ¨å®š</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    .log { margin-top: 1em; }
  </style>
</head>
<body>
  <h1>BLEè·é›¢æ¨å®šãƒ„ãƒ¼ãƒ«</h1>
  <button id="start-scan">ã‚¹ã‚­ãƒ£ãƒ³é–‹å§‹</button>

  <div class="log" id="log"></div>

  <script>
    document.getElementById("start-scan").addEventListener("click", async () => {
      try {
        const scan = await navigator.bluetooth.requestLEScan({
          acceptAllAdvertisements: true
        });

        navigator.bluetooth.addEventListener('advertisementreceived', event => {
          const deviceName = event.device.name || '(åå‰ãªã—)';
          const rssi = event.rssi;
          const txPower = -59; // é€šå¸¸ã®TxPowerä»®å®šå€¤ï¼ˆå¿…è¦ã«å¿œã˜ã¦èª¿æ•´ï¼‰

          // è·é›¢æ¨å®šè¨ˆç®—
          const distance = Math.pow(10, (txPower - rssi) / 20);

          // è¡¨ç¤ºæ›´æ–°
          const logDiv = document.getElementById('log');
          logDiv.innerHTML = `
            <p>ğŸ“¡ ãƒ‡ãƒã‚¤ã‚¹å: <strong>${deviceName}</strong></p>
            <p>ğŸ”‹ RSSI: ${rssi} dBm</p>
            <p>ğŸ“ æ¨å®šè·é›¢: <strong>${distance.toFixed(2)} m</strong></p>
            <hr>
          `;
        });

      } catch (err) {
        alert("ã‚¹ã‚­ãƒ£ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: " + err);
      }
    });
  </script>
</body>
</html>
